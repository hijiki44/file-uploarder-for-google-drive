<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <script>
      function updateUrl(url) {
        var div = document.getElementById('output');
        div.innerHTML = 'ファイルの送信を完了しました。このまま画面を閉じてください。';
      }
      function clickUpload(formObject) {
        console.log(formObject);
        
        // formObject の中身
        //<form id="form" action="" method="get" enctype="application/x-www-form-urlencoded" target="">
        //        <input type="file" name="files[]" webkitdirectory="">
        //       <input type="button" value="アップロード" onclick="clickUpload(this.parentNode)" name="">
        //</form>
        
        console.log(formObject.file);
        
        //console.log(formObject.files);
        //console.log(formObject.files[0]);
        //console.log(formObject.files.length);
        
        google.script.run.withSuccessHandler(updateUrl).processForm(formObject);
      }
      //function handleFileSelect(evt) {
      function handleFileSelect(formObject) {
        //var files = evt.target.files; // FileList object
        var files = formObject.files;
        // files is a FileList of File objects. List some properties.
        var output = [];
        for (var i = 0, f; f = files[i]; i++) {
          output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ') - ',
                  f.size, ' bytes, last modified: ',
                  f.lastModifiedDate.toLocaleDateString(), '</li>');
        }
        document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
      }
      //document.getElementById('files').addEventListener('change', handleFileSelect, false);
      
      //function handleFormSubmit(formObject) {
      //  var div = document.getElementById('output');
      //  div.innerHTML = 'handleFormSubmit が呼び出されました。';
      //  var files = formObject.files;
      //  alert(files.length);
      //  google.script.run.withSuccessHandler(updateUrl).processForm(formObject);
      //}
    </script>
    <style>
      .container {
        width: 480px;
        padding: 10px;
        margin: 50px auto;
        display: block;
      }
      input { 
        display: block; 
        margin: 20px 0; 
      }
      h1 { 
        font-size: 18px;
        font-weight: normal;
        line-height: 30px;
        margin-bottom: 20px;
      }
      p { 
        font-size: 14px; 
        line-height: 24px; 
        margin-bottom: 20px;
      }
      #upload input[type="button"] { 
        width: auto; 
        margin: right: 0; 
        text-align: right;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ファイル添付1</h1>
      <p>添付するファイルがある場合は、ファイルを選択後アップロードをクリックしてください。</p>
      <form id="form">
        <!-- http://qiita.com/akase244/items/f5f7287cfe28bebe00fc -->
        <!--<input type="file" name="files[]" webkitdirectory />-->
        <input type="file" name="files[]" multiple />
        <!--<input type="file" name="file" />-->
        <!--<input type="button" value="アップロード" onclick="google.script.run.withSuccessHandler(updateUrl).processForm(this.parentNode)" />-->
        <!--<input type="button" name="upload" value="アップロード" onclick="clickUpload(this.parentNode)" />-->
        <input type="button" name="upload" value="アップロード" onclick="handleFileSelect(this.parentNode);" />
      </form>
      <div id="output"></div>
    </div>
      
      <!--<form id="upload" onsubmit="handleFormSubmit(this)">-->
      <!--<form id="upload">-->
        <!--<input type="file" name="files[]" multiple="multiple" />-->
         <!--<input type="file" name="file" />-->
         <!--<input type="button" value="アップロード" onclick="google.script.run.withSuccessHandler(updateUrl).processForm(this.parentNode)" />-->
        <!--<input type="submit" value="アップロード" />-->
       <!--</form>-->
       <!--<div id="output"></div>-->
     <!--</div>-->
  </body>
</html>


